<!doctype html>
<html lang="en">
  <head>
    <title>EasyFare Calculator</title>
    <!-- link to css -->
     <link rel = "stylesheet" href = "fare-style.css">
  </head>
  <body>
    <!-- nav bar code -->
    <nav class="navbar">
      <ul class="nav-list">
        <li><a href="/">Home</a></li>
        <li><a href="trainTime.html">Live Departures</a></li>
        <li><a href="bikes.html">Bicycle Checker</a></li>
        <li><a href="fare_calculator.html">Fare Calculator</a></li>
      </ul>
    </nav>  
    <h1 class="fare_heading">Fare Calculator</h1>
    <h3 class="user_guide">
      Welcome to the EasyFare calculator. Enter your stop name and Leap Card
      type to view your fare details.
    </h3>

    <p class="stop_note">
      The DART and Luas are located within Zone 1. Owing to limited space, there may be some stops that are not named on the map.
    </p>

    <!-- containers for the calculator and the map -->
    <div class = "main_content">

        <!-- to the left side of the page-->
        <div class="fare_calc">
        <label for="stop_name">Stop Name:</label>
        <input
            type="text"
            id="stop_name"
            name="stop_name"
            placeholder="Enter stop name"
            required />
        <br />
        <label for="leap_card">Leap Card Type:</label>
        <select id="leap_card" name="leap_card" required>
          <option value="Child">Child</option>
          <option value="Young Adult">Young Adult</option>
          <option value="Student">Student</option>
          <option value="Adult">Adult</option>
        </select>
        <br />
        <button type="button" id = "fare_button">Find my Fare</button>
        <br />
        <!-- the table where the fare information from MongoDB will display -->
        <table id = "fare_table">
            <tr>
                <th>Zone Fare</th>
                <th>Weekly Fare</th>
                <th>Monthly Fare</th>
            </tr>
            <tr>
              <td id = "single_fare"></td> <!-- holds the zone fare -->
              <td id = "weekly_fare"></td> <!-- holds the weekly fare -->
              <td id = "monthly_fare"></td> <!-- holds the monthly fare -->
            </tr>
        </table>
        </div>

        <!-- to the right side of the page-->
         <div class = "map_container">
            <img src="/imgs/Leap-Fare_Zones.png" alt = "A map of the Dublin commuter zones" class = "fare_map" width = 500 height= 500/>
         </div>
    </div>

    <!-- js code to put the data in the table-->
     <script>
      document.getElementById("fare_button").addEventListener("click", async () => {

        const stopName = document.getElementById("stop_name").value;
        const cardType = document.getElementById("leap_card").value;

        try {
          const response = await fetch("/calculate-fare", {
            method: "POST",
            headers: {
              "Content-Type" : "application/json"
            },
            body: JSON.stringify({ stopName, cardType})
          });

          const data = await response.json();

          if (!response.ok) {
            alert(data.error);
            return;
          }

          // Insert values into the table
          document.getElementById("single_fare").textContent = data.singleFare;
          document.getElementById("weekly_fare").textContent = data.weeklyFare;
          document.getElementById("monthly_fare").textContent = data.monthlyFare;
        } catch (error) {
          console.error("Error fetching fare: ", error);
          alert("Something went wrong.");
        }
      });
     </script>
  </body>
</html>